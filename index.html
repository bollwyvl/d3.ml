---
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      /* Deploy */
      @import "https://cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/css/materialize.min.css";
      @import "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/codemirror.min.css";
      @import "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/theme/blackboard.css";
      @import "https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/addon/fold/foldgutter.css";
      
      
      
      /* Development 
      @import "/bower_components/materialize/dist/css/materialize.min.css";
      @import "/bower_components/codemirror/lib/codemirror.css";
      @import "/bower_components/codemirror/theme/blackboard.css";
      @import "/bower_components/codemirror/addon/fold/foldgutter.css";
      */
      
      @import "{{site.baseurl}}/css/app.css"
    </style>
  </head>
  <body>
    <script id="layout" type="text/yaml">
    build:
    - call: 
      - template: :d3.templates.tabs

    - call: 
      - template: :d3.templates.navbar
    - call:
      - append: $div.mode#template
    - call:
      - append: $div.col#toolbar
      - call:
        - append: $a.waves-effect.waves-light.btn.col.s2#preview-toggle
        - text: HTML
      - call:
        - append: $div.row
        - call:
          - append: $div.input-field.col.s10.download
          - call:
            - append: $i.mdi-file-file-download prefix
          - call:
            - append: $input.validate#template-url
            - attr:
                type: text
          - call:
            - append: $label
            - attr:
                for: template-url
            - text: Template URL
    preview:
    - call:
      - append: $div.row#preview
      - call:
        - append: $div.container
        - call:
          - append: h5
          - text: This tool creates webpages by the key stroke.
        - call:
          - append: $p.flow-text
          - text: Mark up the YAML editor with d3-like commands to build a DOM with inline data.
            
    navbar:
    - append: $nav.lime
    - style:
        bottom: 0px
        position: fixed
    - call:
      - append: $div.nav-wrapper
      - call:
        - append: $div.cm-actions.right
        - datum: 
          - name: Hide Tabs
            id: '#toggle-tabs'
          - name: Show Editor
            id: '#toggle-editor'
        - template: :d3.templates.list

      - call:
        - append: $div.d3-actions.left
        - datum: 
          - name: templates
            id: 'template-modal'
          - name: requests
            id: 'request-modal'
          - name: domains
            id: 'domain-modal'
        - template: :d3.templates.list

    list: 
    - append: $ul.right
    - selectAll: li
    - data: '@'
    - call: 
      - enter:
      - append: $li
      - append: $a.flow-text
      - attr:
          id: '@id'
      - text: '@name'

    brand:
    - call:  
      - append: $a.brand-logo.left.lime.darken-3
      - text: d3.template
      - attr:
          href: '#'
          
    tabs:
    - append: $div.row
    - datum:
      - name: preview
        href: '#preview-tab'
        id: 'preview-tab'
        bod: jerz
      - name: html
        href: '#html-tab'
        id: 'html-tab'
        bod: t-bone
    - call:
      - append: $div.s12.tab-list
      - append: $ul.tabs
      - selectAll: li
      - data: '@'
      - call:
        - enter: 
        - append: $li.tab.col.s6
        - append: $a
        - each:
          - attr: 
              href: '@href'
        - text: '@name'
    - call:
      - selectAll: .tab-body
      - data: '@'
      - call: 
        - enter:
        - append: $div.col.s12.tab-body
        - attr:   
            id: '@id'
    - call:
      - js: $('.tab-list .tabs').tabs();
    - call:
      # template will get executed on click in service
      - select: '#preview-tab'
      - template: :d3.templates.preview
      
    modal: 
    - append: $div.modal#modal-box
    - call:
      - append: $div.modal-content
      - call:
        - append: h4  
        - text: Modal Header  
      - call:
        - append: p
        - text: A bunch of text
    - call:
      - append: $div.modal-footer
      - append: $a.waves-effect.waves-green.btn-flat.modal-action.modal-close##
      - text: close
    - call:
      - js: "$('.modal-trigger').leanModal()" 
    </script>
    

    <!-- Deploy -->
    <script src="//cdn.jsdelivr.net/g/d3js,jquery">
      </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/codemirror.js">
      </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/mode/yaml/yaml.js">
      </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/addon/fold/foldcode.js">
      </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/addon/fold/foldgutter.js">
      </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/addon/fold/indent-fold.js">
      </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.0.0/addon/fold/comment-fold.js">
      </script>


    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.95.3/js/materialize.min.js">
      </script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js">
      </script>
    
    
    <!-- Development 
    <script src="/bower_components/d3/d3.min.js">
          </script>
    <script src="/bower_components/jquery/dist/jquery.min.js">
          </script>
    <script src="/bower_components/codemirror/lib/codemirror.js">
          </script>
    <script src="/bower_components/codemirror/mode/yaml/yaml.js">
      </script>
    <script src="/bower_components/codemirror/addon/fold/foldcode.js">
      </script>
    <script src="/bower_components/codemirror/addon/fold/foldgutter.js">
      </script>
    <script src="/bower_components/codemirror/addon/fold/indent-fold.js">
      </script>
    <script src="/bower_components/codemirror/addon/fold/comment-fold.js">
      </script>
    <script src="/bower_components/materialize/dist/js/materialize.min.js">
      </script>
    <script src="/bower_components/js-yaml/dist/js-yaml.min.js">
      </script>
    -->
    
    <script src="{{site.baseurl}}/js/d3.template.js">
      </script>
    <script src="{{site.baseurl}}/js/d3.gridder.js">
      </script>


    <script>
      ;( function(){
        d3.select('body')
          .template( 
            jsyaml.load( d3.select('#layout').html() ), function(d){ return d.build }
          )
        
        d3.select('#template-modal')
          .classed('modal-trigger',true)
          .attr('href','#modal-box')
        
        d3.select('body')
          .template( 
            d3.templates, function(d){ return d.modal }
          )
        
        
        var toolbarHeight = 68,
          showEditor = 1;

        var template = d3.select('#template'),
          preview = d3.select('#preview'),
          templateUrl = d3.select("#template-url"),
          win = d3.select(window);

        var editor = CodeMirror(template.node(), {
          theme: "blackboard",
          mode: "yaml",
          lineNumbers: true,
          lineWrapping: true,
          extraKeys: {"Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); }},
          foldGutter: {
            rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.indent, CodeMirror.fold.comment)
          },
          gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
        });



        d3.selectAll('#toggle-editor')
          .on('click', function(){
            template.style('display',
              (showEditor = !showEditor) ? "block" : "none"
            );
          });
        
        d3.selectAll('#preview-toggle')
          .datum( 'HTML' )
          .on( 'click', function(d){
             if (d == 'HTML'){
               d3.select('#preview')
                 .text( function(){
                    return this.innerHTML
                 })
               
               d3.select(this)
                 .datum( 'preview')
                 .text( function(d){ return d;})
             } else if ( d== 'preview' ){
               d3.select('#preview')
                 .html( function(){
                    return this.innerText
                 })
               d3.select(this)
                 .datum( 'HTML')
                 .text( function(d){ return d;})

             }
               
          })

        editor.on('change', update);
        win.on("resize", resize);
        templateUrl.on("change", updateHash);
        win.on("hashchange", load)

        win.on("resize")();

        if(hash()){
          templateUrl.property("value", hash());
          templateUrl.on("change")();
        }
        

        function hash(value){
          if(value){
            window.location.hash = value;
          }
          return window.location.hash.slice(1);
        }

        function updateHash(){
          hash(templateUrl.property("value"));
          win.on("hashchange")()
        }

        function load(){
          d3.text(hash(), 'text/yaml', function(d){
            editor.setValue(d);
          });
        }

        function update(){

          preview.call( function(s){
            s.html('')
             .template(  
              jsyaml.load( editor.getValue() ), function(d){ return d.display } 
            )
          });
        }

        function resize(){
          editor.setSize(
            null,
            (win.node().innerHeight - toolbarHeight) + "px"
          )
        }
      })();
    </script>
  </body>
</html>
